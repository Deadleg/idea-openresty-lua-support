<p><strong>syntax:</strong> <em>ngx.req.init_body(buffer_size?)</em></p>
<p><strong>context:</strong> <em>set_by_lua&#42;, rewrite_by_lua&#42;, access_by_lua&#42;, content_by_lua&#42;</em></p>
<p>Creates a new blank request body for the current request and inializes the buffer for later request body data writing via the <a href="#ngxreqappend_body">ngx.req.append_body</a> and <a href="#ngxreqfinish_body">ngx.req.finish_body</a> APIs.</p>
<p>If the <code>buffer_size</code> argument is specified, then its value will be used for the size of the memory buffer for body writing with <a href="#ngxreqappend_body">ngx.req.append_body</a>. If the argument is omitted, then the value specified by the standard <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#client_body_buffer_size">client_body_buffer_size</a> directive will be used instead.</p>
<p>When the data can no longer be hold in the memory buffer for the request body, then the data will be flushed onto a temporary file just like the standard request body reader in the Nginx core.</p>
<p>It is important to always call the <a href="#ngxreqfinish_body">ngx.req.finish_body</a> after all the data has been appended onto the current request body. Also, when this function is used together with <a href="#ngxreqsocket">ngx.req.socket</a>, it is required to call <a href="#ngxreqsocket">ngx.req.socket</a> <em>before</em> this function, or you will get the "request body already exists" error message.</p>
<p>The usage of this function is often like this:</p>
<p>```lua</p>
<p>ngx.req.init_body(128 * 1024) -- buffer is 128KB  for chunk in next_data_chunk() do  ngx.req.append_body(chunk) -- each chunk can be 4KB  end  ngx.req.finish_body() ```</p>
<p>This function can be used with <a href="#ngxreqappend_body">ngx.req.append_body</a>, <a href="#ngxreqfinish_body">ngx.req.finish_body</a>, and <a href="#ngxreqsocket">ngx.req.socket</a> to implement efficient input filters in pure Lua (in the context of <a href="#rewrite_by_lua">rewrite_by_lua*</a> or <a href="#access_by_lua">access_by_lua*</a>), which can be used with other Nginx content handler or upstream modules like <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html">ngx_http_proxy_module</a> and <a href="http://nginx.org/en/docs/http/ngx_http_fastcgi_module.html">ngx_http_fastcgi_module</a>.</p>
<p>This function was first introduced in the <code>v0.5.11</code> release.</p>