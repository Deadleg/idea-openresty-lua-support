<p><strong>syntax:</strong> <em>ngx.req.set_uri(uri, jump?)</em></p>
<p><strong>context:</strong> <em>set_by_lua&#42;, rewrite_by_lua&#42;, access_by_lua&#42;, content_by_lua&#42;, header_filter_by_lua&#42;, body_filter_by_lua&#42;</em></p>
<p>Rewrite the current request's (parsed) URI by the <code>uri</code> argument. The <code>uri</code> argument must be a Lua string and cannot be of zero length, or a Lua exception will be thrown.</p>
<p>The optional boolean <code>jump</code> argument can trigger location rematch (or location jump) as <a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html">ngx_http_rewrite_module</a>'s <a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#rewrite">rewrite</a> directive, that is, when <code>jump</code> is <code>true</code> (default to <code>false</code>), this function will never return and it will tell Nginx to try re-searching locations with the new URI value at the later <code>post-rewrite</code> phase and jumping to the new location.</p>
<p>Location jump will not be triggered otherwise, and only the current request's URI will be modified, which is also the default behavior. This function will return but with no returned values when the <code>jump</code> argument is <code>false</code> or absent altogether.</p>
<p>For example, the following Nginx config snippet</p>
<p>```nginx</p>
<p>rewrite ^ /foo last;</p>
<p>```</p>
<p>can be coded in Lua like this:</p>
<p>```lua</p>
<p>ngx.req.set_uri("/foo", true)</p>
<p>```</p>
<p>Similarly, Nginx config</p>
<p>```nginx</p>
<p>rewrite ^ /foo break;</p>
<p>```</p>
<p>can be coded in Lua as</p>
<p>```lua</p>
<p>ngx.req.set_uri("/foo", false)</p>
<p>```</p>
<p>or equivalently,</p>
<p>```lua</p>
<p>ngx.req.set_uri("/foo")</p>
<p>```</p>
<p>The <code>jump</code> argument can only be set to <code>true</code> in <a href="#rewrite_by_lua">rewrite_by_lua*</a>. Use of jump in other contexts is prohibited and will throw out a Lua exception.</p>
<p>A more sophisticated example involving regex substitutions is as follows</p>
<p>```nginx</p>
<p>location /test {  rewrite_by_lua_block {  local uri = ngx.re.sub(ngx.var.uri, "^/test/(.*)", "/$1", "o")  ngx.req.set_uri(uri)  }  proxy_pass http://my_backend;  }</p>
<p>```</p>
<p>which is functionally equivalent to</p>
<p>```nginx</p>
<p>location /test {  rewrite ^/test/(.*) /$1 break;  proxy_pass http://my_backend;  }</p>
<p>```</p>
<p>Note that it is not possible to use this interface to rewrite URI arguments and that <a href="#ngxreqset_uri_args">ngx.req.set_uri_args</a> should be used for this instead. For instance, Nginx config</p>
<p>```nginx</p>
<p>rewrite ^ /foo?a=3? last;</p>
<p>```</p>
<p>can be coded as</p>
<p>```nginx</p>
<p>ngx.req.set_uri_args("a=3")  ngx.req.set_uri("/foo", true)</p>
<p>```</p>
<p>or</p>
<p>```nginx</p>
<p>ngx.req.set_uri_args({a = 3})  ngx.req.set_uri("/foo", true) ```</p>
<p>This interface was first introduced in the <code>v0.3.1rc14</code> release.</p>